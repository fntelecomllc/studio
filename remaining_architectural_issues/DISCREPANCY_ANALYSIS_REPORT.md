# Discrepancy Analysis Report

This report details the discrepancies found between the Go backend, PostgreSQL database, and TypeScript frontend based on the provided asset inventories. The Go backend is considered the source of truth.

| ID | Severity | Entity/Endpoint | Layer | Location (`file:line`) | Mismatch Description | Recommended Action |
|----|----------|-----------------|-------|------------------------|----------------------|--------------------|
| 1  | Medium   | User            | Frontend | `src/lib/types.ts` | The `User.ID` type is `string`, but it should be a `uuid.UUID` from the backend. While `uuid.UUID` is a string, being more specific improves type safety. | Update the TypeScript type to be a branded type for UUIDs, e.g., `export type UUID = string;`. |
| 2  | Low      | User            | Database | `auth.users` | The columns `first_name` and `last_name` use snake_case, while the Go model uses PascalCase (`FirstName`, `LastName`). | This is a common convention difference, but for consistency, an ORM or mapping layer should handle this translation automatically. No immediate action is required unless it causes serialization issues. |
| 3  | Medium   | User            | Frontend | `src/lib/types.ts` | The `User.lastLoginIp` is typed as `string | undefined`, but the backend type is `*net.IP`. This could lead to improper handling of IP address formats. | The frontend should validate the IP address format or use a more specific string format type if needed. |
| 4  | Medium   | Campaign        | Frontend | `src/lib/types.ts` | The `Campaign.userId` type is `string | undefined`, but it should be a `uuid.UUID` from the backend. | Similar to the User ID, use a branded `UUID` type in TypeScript. |
| 5  | High     | Campaign        | Frontend | `src/lib/types.ts` | `totalItems`, `processedItems`, `successfulItems`, and `failedItems` are `number` in TypeScript, but `int64` in Go. This can lead to precision loss for large numbers. | Use the `bigint` type in TypeScript and ensure that it is handled correctly throughout the frontend application. |
| 6  | High     | API Endpoint    | Frontend | `src/lib/services/authService.ts` | The `updatePassword` function calls `POST /api/v2/auth/change-password`, but the backend route is `POST /api/v2/change-password`. | Correct the endpoint path in `src/lib/services/authService.ts` to `/api/v2/change-password`. |
| 7  | High     | API Endpoint    | Backend | `backend/internal/api/campaign_orchestrator_handlers.go` | The frontend calls `/api/v2/campaigns/{campaignId}/start` and `/api/v2/campaigns/{campaignId}/pause`, but these routes are not explicitly listed in the backend inventory. | The backend needs to either implement these routes or the frontend needs to be updated to use the correct endpoints for starting and pausing campaigns. |
| 8  | Medium   | API Endpoint    | Frontend | `src/lib/services/authService.ts` | The frontend does not consume the `GET /api/v2/auth/permissions` endpoint. | Implement a mechanism in the frontend to fetch and use user permissions to control UI elements and access. |
| 9  | Medium   | API Endpoint    | Frontend | `src/lib/services/authService.ts` | The admin user management endpoints (`/api/v2/admin/users/...`) are not consumed by the frontend. | If admin functionality is required, implement the corresponding service calls and UI components in the frontend. |
| 10 | Low      | API Endpoint    | Frontend | `src/lib/services/personaService.production.ts` | The `POST /api/v2/personas/:id/test` endpoint is not used. | This might be an unused feature. Either implement a "Test Persona" button in the UI or remove the endpoint if it's obsolete. |
| 11 | Medium   | API Endpoint    | Frontend | `src/lib/services/proxyService.production.ts` | The proxy management and health check endpoints are not consumed by the frontend. | Implement UI features for managing and monitoring proxies if this functionality is intended to be user-facing. |
| 12 | High     | WebSocket       | Backend | `backend/internal/websocket/client.go` | The `WebSocketMessage` struct has both `Data` and `Payload` fields, which is redundant and confusing. | Consolidate into a single `payload` or `data` field and update all related backend and frontend code. |
| 13 | High     | WebSocket       | Both | `backend/internal/websocket/client.go`, `src/lib/schemas/websocketMessageSchema.ts` | There is a structural mismatch between the backend's flat WebSocket message and the frontend's expectation of nested data structures based on message type. | The backend should send messages with a consistent structure, where the `data` field contains a payload specific to the message `type`. The frontend's Zod schema should be updated to reflect this. |
| 14 | High     | Security        | Frontend | N/A | The frontend does not appear to handle the extensive permission-based access control implemented in the backend. | The frontend must fetch user permissions and use them to conditionally render UI elements and routes, providing a better user experience and preventing unauthorized actions. |